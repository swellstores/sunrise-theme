<script>
  console.group('Navigation Menu Structure');
  console.log('Selected Menu:', {{ section.settings.selected_menu | json }});
  console.log('Menu Links:', {{ linklists[section.settings.selected_menu].links | json }});
</script>

{% style %}
  .mega-menu-wrapper,
  .standard-dropdown {
    display: none;
    z-index: 40;
    position: absolute;
    background-color: white;
    border: 1px solid #eee;
    box-shadow:
      0 4px 6px -1px rgba(0, 0, 0, 0.1),
      0 2px 4px -1px rgba(0, 0, 0, 0.06);
    border-radius: 4px;
  }

  .standard-dropdown {
    min-width: 200px;
    left: 0;
    margin-top: 38px;
  }

  .mega-menu-wrapper {
    width: 100%;
    display: none;
    visibility: hidden;
    opacity: 0;
    z-index: -1;
    min-height: 628px;
    height: auto;
  }

  .mega-menu-wrapper.active {
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
    z-index: 1000 !important;
  }

  .mega-menu-wrapper.active * {
    visibility: visible !important;
    opacity: 1 !important;
  }

  .mega-menu-grid {
    display: flex;
    flex-direction: column;
    gap: 24px;
    width: 100%;
    max-width: 1440;
    margin: 0 auto;
    padding: 32px 120px 32px 120px;
    min-height: var(--mega-menu-height);
    color: #111827;
    z-index: 1001;
    background-color: white;
  }

  .mega-menu-category {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .mega-menu-category-title {
    font-weight: 500;
    color: #111827;
    margin: 0;
  }

  .mega-menu-links {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .mega-menu-link {
    color: #6b7280;
    text-decoration: none;
    transition: color 0.15s ease;
  }

  .mega-menu-link:hover {
    color: #111827;
  }

  .hover-bridge {
    position: absolute;
    top: 100%;
    left: 0;
    width: 100%;
    height: 52px;
    background: transparent;
  }

  .nav-item {
    position: relative;
    height: 100%;
  }

  .group:hover .standard-dropdown,
  .group:hover .hover-bridge {
    display: block;
  }

  .mega-menus-container {
    position: absolute;
    top: 100%;
    left: 0;
    width: 100%;
    z-index: 30;
    min-height: var(--mega-menu-height);
    height: auto;
    pointer-events: none;
  }

  .mega-menu-wrapper.active {
    pointer-events: auto;
  }

  .nav-container {
    position: relative;
    width: 100%;
    max-width: 1440px;
    margin: 0 auto;
    z-index: 40;
  }

  header {
    position: relative;
    z-index: 50;
  }
{% endstyle %}

<script>
  // Mega menu toggle functions
  function showMegaMenu(id) {
    const megaMenu = document.getElementById(id);
    if (megaMenu) {
      megaMenu.classList.add('active');
    }
  }

  function keepMenuVisible(id) {
    const megaMenu = document.getElementById(id);
    if (megaMenu) {
      megaMenu.classList.add('active');
    }
  }

  function hideMegaMenu(id) {
    const megaMenu = document.getElementById(id);
    if (megaMenu) {
      setTimeout(() => {
        if (
          !document.querySelector(`#${id}:hover`) &&
          !document.querySelector(`[data-nav-item]:hover a[onmouseover*="${id}"]`)
        ) {
          megaMenu.classList.remove('active');
        }
      }, 100);
    }
  }
</script>

<nav role="navigation" class="flex justify-center h-full items-center w-full">
  <div class="nav-container">
    <ul class="flex gap-3 h-full justify-center items-center md:gap-[48px]">
      {% assign selected_menu = section.settings.selected_menu | default: 'main-menu' %}
      {% assign menu_links = linklists[selected_menu].links %}

      {% for link in menu_links %}
        <li
          class="nav-item font-display flex h-full items-center text-label-large group"
          data-nav-item="{{ forloop.index }}"
        >
          <a
            href="{{ link.url }}"
            class="flex h-full items-center whitespace-nowrap px-2 group-hover:text-gray-900 transition-colors"
            {% if link.links.size > 0 %}
              {% assign has_grandchild = false %}
              {% for child in link.links %}
                {% if child.links.size > 0 %}
                  {% assign has_grandchild = true %}
                {% endif %}
              {% endfor %}
              {% if has_grandchild %}
                onmouseover="showMegaMenu('mega-menu-{{ forloop.index }}')"
                onmouseout="hideMegaMenu('mega-menu-{{ forloop.index }}')"
              {% endif %}
            {% endif %}
          >
            {{ link.title }}
            {% if link.links.size > 0 %}
              <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
              </svg>
            {% endif %}
          </a>

          {% if link.links.size > 0 %}
            <div class="hover-bridge"></div>
            {% assign has_grandchild = false %}
            {% for child in link.links %}
              {% if child.links.size > 0 %}
                {% assign has_grandchild = true %}
              {% endif %}
            {% endfor %}

            {% unless has_grandchild %}
              {% render 'standard-dropdown', links: link.links %}
            {% endunless %}
          {% endif %}
        </li>
      {% endfor %}
    </ul>
  </div>
</nav>

<div class="mega-menus-container">
  {% for link in menu_links %}
    {% if link.links.size > 0 %}
      {% assign has_grandchild = false %}
      {% for child in link.links %}
        {% if child.links.size > 0 %}
          {% assign has_grandchild = true %}
        {% endif %}
      {% endfor %}

      {% if has_grandchild %}
        <div
          id="mega-menu-{{ forloop.index }}"
          class="mega-menu-wrapper"
          onmouseover="keepMenuVisible('mega-menu-{{ forloop.index }}')"
          onmouseout="hideMegaMenu('mega-menu-{{ forloop.index }}')"
        >
          {% render 'mega-menu', current_link: link %}
        </div>
      {% endif %}
    {% endif %}
  {% endfor %}
</div>
