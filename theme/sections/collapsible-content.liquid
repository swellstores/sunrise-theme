{%- liquid
  assign color_scheme = section.settings.color_scheme
  assign container_color_scheme = section.settings.container_color_scheme
  assign top_padding = section.settings.top_padding | times: 0.1 | round: 1
  assign bottom_padding = section.settings.bottom_padding | times: 0.1 | round: 1
  assign reduced_padding_top = top_padding | times: 0.55 | round: 2
  assign reduced_padding_bottom = bottom_padding | times: 0.55 | round: 2
-%}

{% style %}
  .responsive-padding-{{ section.id }} {
    padding-top: {{ reduced_padding_top }}rem;
    padding-bottom: {{ reduced_padding_bottom }}rem;
  }

  @media (min-width: 1024px) {
    .responsive-padding-{{ section.id }} {
      padding-top: {{ top_padding }}rem;
      padding-bottom: {{ bottom_padding }}rem;
    }
  }
{% endstyle %}

<div class="bg-{{ section.settings.color_scheme }} gradient">
  <div
    class="
      relative
      isolate
      md:p-140
      pl-24
      pr-24
      pt-64
      pb-64
      lg:pl-160
      lg:pr-160
      lg:pt-96
      lg:pb-96
      responsive-padding-{{ section.id }}
      {% if section.settings.layout == 'section' %}
        max-w-screen-lg mx-auto bg-{{ container_color_scheme }}
      {% elsif section.settings.layout == 'none' %}
        w-full
      {% endif %}
    "
  >
    <div class="section-{{ section.id }}-padding w-full">
      <div class="{% if section.settings.image == blank %} max-w-620 mx-auto {% else %} w-full {% endif %}">
        <div
          class="
            items-center
            grid
            grid-cols-1
            gap-40
            {% if section.settings.image != blank %}
              md:grid-cols-2
            {% endif %}
          "
        >
          {%- if section.settings.desktop_layout == 'image_first' and section.settings.image != blank -%}
            {% render 'collapsible-content-image',
              section: section
            %}
          {%- endif -%}

          <div
            class="
              flex
              flex-col
              gap-24
              {% if section.settings.layout == 'section' %}
                text-{{ container_color_scheme }}
              {% else %}
                text-{{ color_scheme }}
              {% endif %}
            "
          >
            <div class="text-{{ section.settings.header_alignment | default: 'center' }} flex flex-col gap-8">
              {% if section.settings.pre_heading %}
                <h2 class="font-display font-pre-heading text-pre-heading">
                  {{ section.settings.pre_heading }}
                </h2>
              {% endif %}
              {% if section.settings.heading %}
                <h2 class="font-display font-heading text-heading-{{ section.settings.heading_size | default: 'small' }}">
                  {{ section.settings.heading }}
                </h2>
              {% endif %}
              {% if section.settings.text %}
                <div class="formatted-text">
                  <p class="font-display text-content">
                    {{ section.settings.text }}
                  </p>
                </div>
              {% endif %}
            </div>

            <accordion-root
              class="
                grid
                items-center
                justify-center
                w-full
                {% if section.settings.layout == 'row' %}
                  gap-16
                  text-{{ container_color_scheme }}
                {% elsif section.settings.layout == 'section' %}
                  grid-cols-1
                  text-{{ container_color_scheme }}
                {% else %}
                  text-{{ color_scheme }}
                {% endif %}
              "
            >
              {%- for block in section.blocks -%}
                {%- case block.type -%}
                  {%- when 'collapsible_row' -%}
                    <accordion-item
                      class="
                        flex
                        flex-col
                        w-full
                        p-16
                        border
                        rounded
                        group
                        {% if section.settings.layout == 'row' %}
                          bg-{{ container_color_scheme }}
                          border-color-{{ container_color_scheme }}
                        {% else %}
                          bg-{{ color_scheme }}
                          border-color-{{ color_scheme }}
                        {% endif %}
                        {% if section.settings.layout != 'row' and forloop.index0 > 0 %}
                          -mt-1
                        {% endif %}
                      "
                      aria-expanded="
                        {% if section.settings.open_first_collapsible_row and forloop.first %}
                          true
                        {% else %}
                          false
                        {% endif %}
                      "
                    >
                      <accordion-trigger
                        class="
                          text-title-{{ block.settings.heading_size | default: 'medium' }}
                          font-display
                          font-heading
                          flex
                          w-full
                          items-center
                          justify-between
                        "
                      >
                        {% assign pageTitle = block.settings.page.title | escape %}
                        {{ block.settings.heading | default: pageTitle }}
                        <ion-icon
                          name="chevron-down-outline"
                          aria-label="{{ 'general.accordion.toggle' | t }}"
                          class="
                            transition-transform
                            group-aria-expanded:rotate-180
                            {% if block.settings.heading_size == 'extra-large' %}
                              h-32
                              w-32
                            {% else %}
                              h-16
                              w-16
                            {% endif %}
                          "
                        ></ion-icon>
                      </accordion-trigger>
                      <accordion-content class="body-large">
                        <div class="mt-4">
                          <span class="formatted-text">{{ block.settings.row_content }}</span>
                          {{ block.settings.page.content }}
                        </div>
                      </accordion-content>
                    </accordion-item>
                {%- endcase -%}
              {%- endfor -%}
            </accordion-root>
          </div>

          {%- if section.settings.desktop_layout == 'image_second' and section.settings.image != blank -%}
            {% render 'collapsible-content-image',
              section: section
            %}
          {%- endif -%}

        </div>
      </div>
    </div>
  </div>
</div>

{% schema %}
{
  "name": "Collapsible content",
  "tag": "section",
  "class": "section",
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "inline_richtext",
      "id": "pre_heading",
      "label": "Pre-heading"
    },
    {
      "type": "inline_richtext",
      "id": "heading",
      "label": "Heading",
      "default": "Collapsible content"
    },
    {
      "type": "select",
      "id": "heading_size",
      "label": "Heading size",
      "default": "small",
      "options": [
        { "value": "small", "label": "Small" },
        { "value": "medium", "label": "Medium" },
        { "value": "large", "label": "Large" },
        { "value": "extra-large", "label": "Extra large" }
      ]
    },
    {
      "type": "richtext",
      "id": "text",
      "label": "Text"
    },
    {
      "type": "select",
      "id": "header_alignment",
      "label": "Header alignment",
      "options": [
        {
          "value": "left",
          "label": "Left"
        },
        {
          "value": "center",
          "label": "Center"
        },
        {
          "value": "right",
          "label": "Right"
        }
      ],
      "default": "center"
    },
    {
      "type": "select",
      "id": "layout",
      "label": "Layout",
      "options": [
        {
          "value": "none",
          "label": "No container"
        },
        {
          "value": "row",
          "label": "Row container"
        },
        {
          "value": "section",
          "label": "Section container"
        }
      ],
      "default": "none"
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "scheme-1"
    },
    {
      "type": "color_scheme",
      "id": "container_color_scheme",
      "label": "Row color scheme",
      "default": "scheme-1",
      "conditions": {
        "layout": {
          "$in": ["row", "section"]
        }
      }
    },
    {
      "type": "checkbox",
      "id": "open_first_collapsible_row",
      "default": false,
      "label": "Open first collapsible row"
    },
    {
      "type": "header",
      "content": "Image layout"
    },
    {
      "type": "image_picker",
      "id": "image",
      "label": "Image"
    },
    {
      "type": "select",
      "id": "image_size",
      "label": "Image size",
      "default": "original",
      "options": [
        { "value": "original", "label": "Original" },
        { "value": "small", "label": "Small" },
        { "value": "large", "label": "Large" }
      ]
    },
    {
      "type": "select",
      "id": "desktop_layout",
      "label": "Desktop layout",
      "options": [
        {
          "value": "image_first",
          "label": "Image first"
        },
        {
          "value": "image_second",
          "label": "Image second"
        }
      ],
      "default": "image_second",
      "info": "Image is always first on mobile."
    },
    {
      "type": "header",
      "content": "Section padding"
    },
    {
      "type": "range",
      "id": "top_padding",
      "label": "Top padding",
      "min": 0,
      "max": 96,
      "step": 1,
      "unit": "px",
      "default": 40
    },
    {
      "type": "range",
      "id": "bottom_padding",
      "label": "Bottom padding",
      "min": 0,
      "max": 96,
      "step": 1,
      "unit": "px",
      "default": 40
    }
  ],
  "blocks": [
    {
      "type": "collapsible_row",
      "name": "Collapsible row",
      "settings": [
        {
          "type": "text",
          "id": "heading",
          "label": "Heading",
          "default": "Collapsible row",
          "info": "Include a heading that explains the content."
        },
        {
          "type": "select",
          "id": "heading_size",
          "label": "Heading size",
          "default": "medium",
          "options": [
            { "value": "small", "label": "Small" },
            { "value": "medium", "label": "Medium" },
            { "value": "large", "label": "Large" },
            { "value": "extra-large", "label": "Extra large" }
          ]
        },
        {
          "type": "richtext",
          "id": "row_content",
          "label": "Row content"
        },
        {
          "type": "page",
          "id": "page",
          "label": "Row content from page"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Collapsible content",
      "settings": {
        "heading": "Have questions?",
        "color_scheme": "scheme-1",
        "top_padding": 96,
        "bottom_padding": 96
      },
      "blocks": [
        {
          "type": "collapsible_row",
          "settings": {
            "heading": "What is your return policy?",
            "row_content": "<p>Our return policy lasts 30 days...</p>"
          }
        },
        {
          "type": "collapsible_row",
          "settings": {
            "heading": "Do you offer free shipping?",
            "row_content": "<p>Yes, we offer free shipping on all orders over $50.</p>"
          }
        },
        {
          "type": "collapsible_row",
          "settings": {
            "heading": "How do I track my order?",
            "row_content": "<p>Once your order has been shipped, you'll receive a tracking link...</p>"
          }
        },
        {
          "type": "collapsible_row",
          "settings": {
            "heading": "Can I change my order after placing it?",
            "row_content": "<p>Changes are allowed within 24 hours of placing your order.</p>"
          }
        }
      ]
    }
  ]
}
{% endschema %}
