{% comment %}
  Renders a announcement bar with a single announcement or a slideshow of announcements.
{% endcomment %}

{%- liquid
  assign color_scheme = section.settings.color_scheme
  assign font_weight = section.settings.font_weight

  if section.blocks.size > 0
    assign announcement_bar = true
  endif

  assign dismissible = section.settings.dismissible

  assign home_only = true
  if section.settings.home_only and template != 'index' or template == 'password'
    assign home_only = false
  endif

  if section.settings.text_uppercase == true
    assign text_uppercase = 'uppercase'
  else
    assign text_uppercase = 'normal-case'
  endif

  if section.settings.border_bottom == true
    assign border_bottom = 'border-b border-' | append: color_scheme
  else
    assign border_bottom = 'border-none'
  endif
-%}

{%- if section.blocks.size > 1 -%}
  <script>
    window.theme = window.theme || {};
    window.theme.slideshow_rendered = true;
  </script>
{%- endif -%}

{%- if announcement_bar and home_only -%}
  <announcement-root
    class="bg-{{ color_scheme }} text-{{ color_scheme }} cursor-default relative block font-{{ font_weight }} {{ text_uppercase }} {{ border_bottom }} z-6"
    data-dismissible="true"
  >
    {%- if section.blocks.size == 1 -%}
      {% render 'single-announcement' %}
    {%- endif -%}
    {%- if section.blocks.size > 1 -%}
      {% render 'slideshow-announcement' %}
    {%- endif -%}
    {%- if dismissible -%}
      <div class="absolute right-0 top-0 flex items-center justify-center px-8 h-full">
        <announcement-trigger
          role="button"
          class="size-6 flex items-center justify-center"
          aria-label="{{ 'sections.announcement.dismiss' | t }}"
        >
          <ion-icon name="close-outline" aria-hidden="true"></ion-icon>
        </announcement-trigger>
      </div>
    {%- endif -%}
  </announcement-root>
{%- endif -%}

{% schema %}
{
  "name": "Announcement bar",
  "max_blocks": 8,
  "settings": [
    {
      "type": "checkbox",
      "id": "dismissible",
      "label": "Dismissible",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "home_only",
      "label": "Show on home page only",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "border_bottom",
      "default": false,
      "label": "Border bottom"
    },
    {
      "type": "checkbox",
      "id": "text_uppercase",
      "default": false,
      "label": "Uppercase text"
    },
    {
      "type": "select",
      "id": "font_weight",
      "default": "normal",
      "label": "Font weight",
      "options": [
        {
          "value": "light",
          "label": "Light"
        },
        {
          "value": "normal",
          "label": "Normal"
        },
        {
          "value": "medium",
          "label": "Medium"
        },
        {
          "value": "semibold",
          "label": "Semi-bold"
        },
        {
          "value": "bold",
          "label": "Bold"
        }
      ]
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "scheme-2"
    },
    {
      "type": "checkbox",
      "id": "loop",
      "label": "Loop",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "auto_rotate",
      "label": "Auto-rotate",
      "default": true
    },
    {
      "type": "select",
      "id": "direction",
      "label": "Slide direction",
      "default": "horizontal",
      "options": [
        {
          "value": "horizontal",
          "label": "Horizontal"
        },
        {
          "value": "vertical",
          "label": "Vertical"
        }
      ]
    },
    {
      "type": "range",
      "id": "auto_rotate_speed",
      "min": 3,
      "max": 8,
      "step": 1,
      "unit": "s",
      "label": "Auto-rotate speed",
      "default": 5
    }
  ],
  "blocks": [
    {
      "type": "announcement",
      "name": "Announcement",
      "limit": 8,
      "settings": [
        {
          "type": "text",
          "id": "text",
          "label": "Text",
          "default": "Welcome to our store"
        },
        {
          "type": "url",
          "id": "link",
          "label": "URL"
        }
      ]
    }
  ]
}
{% endschema %}
