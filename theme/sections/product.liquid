{%- liquid
  assign color_scheme = section.settings.color_scheme
  assign loop = section.settings.loop
  assign auto_rotate = section.settings.auto_rotate
  assign media_position = section.settings.desktop_media_position
  assign desktop_layout = section.settings.desktop_layout

  if auto_rotate == true
    assign auto_rotate_speed = section.settings.auto_rotate_speed | times: 1000
  endif

  assign reduced_padding_top = section.settings.top_padding | times: 0.55 | round: 0
  assign reduced_padding_bottom = section.settings.bottom_padding | times: 0.55 | round: 0

  assign media_urls = ''
  assign media_alts = ''
  assign media_ids = ''
  for variant in product.variants
    if variant.featured_media
      unless media_ids contains variant.featured_media.id
        assign media_ids = media_ids | append: variant.featured_media.id | append: ','
        assign media_url = variant.featured_media | image_url
        assign media_urls = media_urls | append: media_url | append: ','
        assign alt = variant.featured_media.alt | escape
        assign media_alts = media_alts | append: alt | append: ','
      endunless
    endif
  endfor

  for media in product.media
    unless media_ids contains media.id
      assign media_ids = media_ids | append: media.id | append: ','
      assign media_url = media.preview_image | image_url
      assign media_urls = media_urls | append: media_url | append: ','
      assign alt = variant.featured_media.alt | escape
      assign media_alts = media_alts | append: alt | append: ','
    endunless
  endfor

  assign media_urls = media_urls | split: ','
  assign media_alts = media_alts | split: ','

  assign selected_or_first_available_variant = product.selected_or_first_available_variant
-%}

{% style %}
  .responsive-padding-{{ section.id }} {
    padding-top: {{ reduced_padding_top }}px;
    padding-bottom: {{ reduced_padding_bottom }}px;
  }

  @media (min-width: 1024px) {
    .responsive-padding-{{ section.id }} {
      padding-top: {{ section.settings.top_padding }}px;
      padding-bottom: {{ section.settings.bottom_padding }}px;
    }
  }
{% endstyle %}

<div
  class="text-{{ color_scheme }} max-w-[1366px] mx-auto lg:pl-[96px] lg:pr-[96px] lg:pt-[64px] lg:pb-[64px] bg-{{ color_scheme }} responsive-padding-{{ section.id }}"
>
  <product-section>
  <div
    class="
      flex
      lg:grid
      lg:gap-[44px]
      2xl:gap-[64px]
      desktop-media
      {%- if media_position == 'right' -%}
        {{ ' lg:grid-cols-[minmax(0,292px)_minmax(0,748px)] 2xl:grid-cols-[minmax(0,362px)_minmax(0,748px)] flex-col-reverse' }}
      {%- else -%}
        {{ ' lg:grid-cols-[minmax(0,748px)_minmax(0,292px)] 2xl:grid-cols-[minmax(0,748px)_minmax(0,362px)] flex-col' }}
      {%- endif -%}
    "
  >
    <div
      class="relative {% if media_position == 'right' %}order-1{% endif %}"
    >
      {%- if media_urls.size < 1 -%}
        <div class="aspect-square w-full">
          {%
            render 'image',
            picture_class: 'svg-placeholder',
            placeholder: 'product-apparel-1' | placeholder_svg_tag: 'placeholder-svg'
          %}
        </div>
      {%- else -%}
        <div class="hidden sm:flex">
          {%- if desktop_layout != 'thumbnail_gallery' -%}
            {% comment %} 'stacked' or implicitly 'two_column' {% endcomment %}
            <div class="gap-[16px] w-full">
              <div class="grid grid-cols-2 gap-4 w-full">
                {% for url in media_urls %}
                  <div class="w-full h-auto {% if desktop_layout == 'stacked' and forloop.index0 == 0 %}col-span-2 pl-[100px] pr-[100px]{% endif %}">
                    <img
                      width="100%"
                      height="100%"
                      src="{{ url }}"
                      alt="{{ media_alts[forloop.index0] }}"
                      class="w-full h-full object-cover"
                    >
                  </div>
                {%- endfor -%}
              </div>
            </div>
          {% endif %}
        </div>

        <div class="{% if desktop_layout != 'thumbnail_gallery' %}sm:hidden{% endif %}">
          <div class="sm:grid sm:gap-[16px] {% if section.settings.show_thumbnails %}sm:grid-cols-2{% else %}sm:grid-cols-1{% endif %}">
            <div class="sm:flex-col sm:items-center {% if section.settings.show_thumbnails and section.settings.thumbnail_position == 'left' %}sm:order-2{% else %}sm:order-1{% endif %}">
              <swiper-container
                role="region"
                aria-label="{{ 'sections.slideshow.label' | t }}"
                loop="{{ loop }}"
                direction="horizontal"
                slides-per-view="1"
                class="text-{{ color_scheme }} swiper-container w-full h-auto"
                space-between="16"
                pagination="true"
                thumbs-swiper=".thumbnail-swiper"
                style="--swiper-pagination-color: black; --swiper-pagination-bottom:0px;"
                {%- if auto_rotate -%}
                  autoplay-delay="{{ auto_rotate_speed }}"
                  autoplay-pause-on-mouse-enter="true"
                {%- endif -%}
              >
                {% for url in media_urls %}
                  <swiper-slide class="flex flex-col items-center text-center gap-[32px] pb-[32px]">
                    <div class="aspect-square m-auto">
                      <div class="aspect-square w-full h-full">
                        <img
                          height="100%"
                          width="100%"
                          src="{{ url }}"
                          alt="{{ media_alts[forloop.index0] }}"
                          class="thumbnail-image cursor-pointer w-full h-full object-cover"
                        >
                      </div>
                    </div>
                  </swiper-slide>
                {% endfor %}
                <div class="swiper-pagination"></div>
              </swiper-container>
            </div>

            {%- if section.settings.show_thumbnails or section.settings.mobile_layout == 'show_mobile_thumbnails' -%}
              {% liquid            
                if section.settings.show_thumbnails
                  assign visibility_class = 'hidden sm:flex'
                  if section.settings.mobile_layout == 'show_mobile_thumbnails'
                    assign visibility_class = 'flex'
                  endif
                else
                  assign visibility_class = 'flex sm:hidden'
                endif
              %}
              <div class="{{ visibility_class }} w-full sm:flex-col sm:items-center sm:justify-center {% if section.settings.thumbnail_position == 'right' %}sm:order-2{% else %}sm:order-1{% endif %}">
                <div class="relative flex w-full sm:flex-col sm:gap-[8px] sm:max-h-[700px] sm:overflow-auto">
                  {%- if media_urls.size > 3 -%}
                    {% render 'mobile-thumbnail-arrows', color_scheme: color_scheme, border_radius: settings.border_radius %}
                  {%- endif -%}
                  <swiper-container
                    class="thumbnail-swiper mt-4 w-full pr-[50px] pl-[50px]"
                    slides-per-view="3"
                    space-between="10"
                    watch-slides-progress="true"
                    watch-slides-visibility="true"
                    loop="true"
                  >
                    {% for url in media_urls %}
                      <swiper-slide class="cursor-pointer">
                        <div class="aspect-square border border-gray-300">
                          <img
                            height="100%"
                            width="100%"
                            src="{{ url }}"
                            alt="{{ media_alts[forloop.index0] }}"
                            class="w-full h-full object-cover"
                          >
                        </div>
                      </swiper-slide>
                    {% endfor %}
                  </swiper-container>
                </div>
              </div>
            {%- endif -%}
          </div>
        </div>
      {%- endif -%}
    </div>

    <div class="w-full flex">
      <div class="flex flex-col gap-[24px] pt-[24px] pr-[24px] pl-[24px] lg:pt-0 lg:pr-0 lg:pl-0">
        <div class="flex flex-col">
          {% for block in section.blocks %}
            {% case block.type %}
              {% when 'title' %}
                {% if block.settings.show_title %}
                  <div
                    class="text-title-large font-display text-{{ color_scheme }} mb-[2px] mt-[2px]"
                    style="margin-top: {{ block.settings.margin_top }}px; margin-bottom: {{ block.settings.margin_bottom }}px;"
                  >
                    {{ product.title }}
                  </div>
                {% endif %}
              {% when 'price' %}
                {% if block.settings.show_price %}
                  {% render 'product-purchase-options',
                      product: product,
                      color_scheme: color_scheme
                  %}
                {% endif %}
              {% when 'category' %}
                {% if block.settings.show_category %}
                  <div
                    class="vendor text-title-large font-display mb-[2px] mt-[2px]"
                    style="margin-top: {{ block.settings.margin_top }}px; margin-bottom: {{ block.settings.margin_bottom }}px;"
                  >
                    {% if product.vendor == blank %}
                      No category set
                    {% else %}
                      {{ product.vendor }}
                    {% endif %}
                  </div>
                {% endif %}
              {% when 'sku' %}
                {% if block.settings.show_sku %}
                  <div
                    id="product-sku"
                    class="sku-span text-body-medium font-display mb-[4px] mt-[4px]"
                    style="margin-top: {{ block.settings.margin_top }}px; margin-bottom: {{ block.settings.margin_bottom }}px;"
                  >
                    {% if product.sku != blank %}
                      {{ product.sku }}
                    {% endif %}
                  </div>
                {% endif %}
              {% when 'quantity_selector' %}
                {% if block.settings.show_quantity_selector %}
                  <div
                    id="quantity-selector-variant"
                    class="mb-[14px] mt-[14px]"
                    style="margin-top: {{ block.settings.margin_top }}px; margin-bottom: {{ block.settings.margin_bottom }}px;"
                  >
                    {% render 'quantity-selector-variant',
                      product: product,
                      variant: product.selected_or_first_available_variant,
                      color_scheme: color_scheme
                    %}
                  </div>
                {% endif %}
              {% when 'variant' %}
                {% if block.settings.variant %}
                  <div id="variant-radio-root"
                    class="variant-selection flex flex-col gap-[8px]"
                    style="margin-top: {{ block.settings.margin_top }}px; margin-bottom: {{ block.settings.margin_bottom }}px;"
                  >
                    {% render 'variant-radio',
                      product: product,
                      product_selector: block.settings.product_selector,
                      color_scheme: color_scheme
                    %}
                  </div>
                {% endif %}
              {% when 'buy_buttons' %}
                {%- liquid
                  unless product.has_only_default_variant
                    assign variant = selected_or_first_available_variant
                  endunless
                -%}
                {% if block.settings.show_buy_buttons %}
                  {% comment %} {% render 'product-form', product: product, cart_type: settings.cart_type %} {% endcomment %}
                  <div id="product-section-buy-buttons">
                    <div class="flex flex-col w-full" >
                      {%- if selected_or_first_available_variant.available -%}
                        {%- if settings.cart_type == 'drawer' -%}
                          <div style="margin-top: {{ block.settings.margin_top }}px; margin-bottom: {{ block.settings.margin_bottom }}px;">
                            {% render 'cart-drawer-button',
                              variant: variant,
                              color_scheme: color_scheme,
                              button_text: block.settings.buy_button_text
                            %}
                          </div>
                        {%- else -%}
                          {%- liquid
                            assign purchaseOptionType = 'standard'
                            assign purchaseOptionPlan = ''
                            if product.purchase_options.standard == blank and product.purchase_options.subscription
                              assign purchaseOptionType = 'subscription'
                              assign purchaseOptionPlan = product.purchase_options.subscription.plans[0].id
                            endif
                          -%}
                          <add-product-form>
                            <input type="hidden" name="product_id" value="{{ product.id }}">
                            <input type="hidden" name="option_values" data-product-options="{{ product.options_with_values | json | url_encode }}" value="{{ selected_or_first_available_variant.selected_option_values | join: ',' }}">
                            <input type="hidden" name="quantity" value="1">
                            <input type="hidden" name="purchase-option-type" value="{{ purchaseOptionType }}">
                            <input type="hidden" name="purchase-option-plan" value="{{ purchaseOptionPlan }}">                   
                            <div style="margin-top: {{ block.settings.margin_top }}px; margin-bottom: {{ block.settings.margin_bottom }}px;">
                              {% render 'button',
                                type: 'submit',
                                text: block.settings.buy_button_text,
                                class: 'add-to-cart-button',
                                color_scheme: color_scheme
                              %}
                            </div>
                          </add-product-form>
                        {%- endif -%}
                      {%- else -%}
                        <span class="text-[#B3261E] font-display text-body-small">Currently unavailable</span>
                      {%- endif -%}
                    </div>
                  </div>
                {% endif %}
              {% when 'description' %}
                {% if block.settings.show_description %}
                  <div
                    class="description font-display text-body-medium mb-[10px] mt-[10px]"
                    style="margin-top: {{ block.settings.margin_top }}px; margin-bottom: {{ block.settings.margin_bottom }}px;"
                  >
                    {% if product.description != blank %}
                      {{ product.description }}
                    {% else %}
                      No description set
                    {% endif %}
                  </div>
                {% endif %}
            {% endcase %}
          {% endfor %}
        </div>

        <accordion-root class="flex-col items-center justify-center gap-[16px]">
          <div class="flex flex-col gap-[16px]">
            {%- for block in section.blocks -%}
              {% case block.type %}
                {% when 'accordion_item' %}
                  <div class="w-full overflow-hidden border-[#F5F5F5] border rounded-[4px] p-[16px]">
                    <accordion-trigger
                      role="button"
                      aria-expanded="false"
                      class="text-title-medium font-display flex w-full items-center justify-between h-full"
                    >
                      {{ block.settings.trigger | inline_editable: 'trigger' }}
                      <ion-icon
                        name="chevron-down-outline"
                        aria-label="{{ 'general.accordion.toggle' | t }}"
                        class="h-4 w-4 transition-transform"
                      >
                      </ion-icon>
                    </accordion-trigger>
                    <accordion-content
                      role="region"
                      class="text-base grid grid-rows-[0fr] opacity-0 overflow-hidden transition-all duration-300 ease-in-out"
                    >
                      <div class="overflow-hidden text-left text-body-small font-display formatted-text">
                        {{ block.settings.content | inline_editable: 'content' }}
                      </div>
                    </accordion-content>
                  </div>
                {% endcase %}
            {%- endfor -%}
          </div>
        </accordion-root>
      </div>
    </div>
  </div>
  </product-section>
</div>

<script>
  window.product = {
    variants: {{ product.variants | json }}
  };
</script>

{% style %}
  .active-thumbnail {
    @apply border border-solid;
    border-color: black;
    border-width: 1px;
    border-radius: 4px;
    padding: 6px;
  }
{% endstyle %}

{% schema %}
{
  "name": "Product",
  "settings": [
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "scheme-1"
    },
    {
      "type": "select",
      "id": "desktop_media_position",
      "label": "Desktop media position",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "right", "label": "Right" }
      ],
      "default": "left"
    },
    {
      "id": "desktop_layout",
      "type": "select",
      "label": "Desktop layout",
      "options": [
        { "value": "thumbnail_gallery", "label": "Thumbnails" },
        { "value": "two_column", "label": "2 columns" },
        { "value": "stacked", "label": "Stacked" }
      ],
      "default": "thumbnail_gallery"
    },
    {
      "type": "checkbox",
      "id": "show_thumbnails",
      "label": "Show thumbnails",
      "default": true,
      "conditions": {
        "desktop_layout": "thumbnail_gallery"
      }
    },
    {
      "type": "select",
      "id": "thumbnail_position",
      "label": "Thumbnail position",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "right", "label": "Right" }
      ],
      "default": "left",
      "conditions": {
        "desktop_layout": "thumbnail_gallery"
      }
    },
    {
      "id": "mobile_layout",
      "type": "select",
      "label": "Mobile layout",
      "options": [
        { "value": "show_mobile_thumbnails", "label": "Show thumbnails" },
        { "value": "hide_mobile_thumbnails", "label": "Hide thumbnails" }
      ],
      "default": "show_mobile_thumbnails"
    },
    {
      "type": "range",
      "id": "top_padding",
      "label": "Top padding",
      "min": 0,
      "max": 96,
      "step": 1,
      "unit": "px",
      "default": 64
    },
    {
      "type": "range",
      "id": "bottom_padding",
      "label": "Bottom padding",
      "min": 0,
      "max": 96,
      "step": 1,
      "unit": "px",
      "default": 64
    }
  ],
  "blocks": [
    {
      "type": "title",
      "name": "Title",
      "limit": 1,
      "settings": [
        {
          "type": "checkbox",
          "id": "show_title",
          "label": "Show product title",
          "default": true
        },
        {
          "type": "range",
          "id": "margin_top",
          "label": "Margin top",
          "min": 0,
          "max": 100,
          "step": 1,
          "default": 0
        },
        {
          "type": "range",
          "id": "margin_bottom",
          "label": "Margin bottom",
          "min": 0,
          "max": 100,
          "step": 1,
          "default": 0
        }
      ]
    },
    {
      "type": "price",
      "name": "Price",
      "limit": 1,
      "settings": [
        {
          "type": "checkbox",
          "id": "show_price",
          "label": "Show product price",
          "default": true
        },
        {
          "type": "range",
          "id": "margin_top",
          "label": "Margin top",
          "min": 0,
          "max": 20,
          "step": 1,
          "unit": "px",
          "default": 2
        },
        {
          "type": "range",
          "id": "margin_bottom",
          "label": "Margin bottom",
          "min": 0,
          "max": 20,
          "step": 1,
          "unit": "px",
          "default": 2
        }
      ]
    },
    {
      "type": "category",
      "name": "Category",
      "limit": 1,
      "settings": [
        {
          "type": "checkbox",
          "id": "show_category",
          "label": "Show category",
          "default": true
        },
        {
          "type": "range",
          "id": "margin_top",
          "label": "Margin top",
          "min": 0,
          "max": 20,
          "step": 1,
          "unit": "px",
          "default": 2
        },
        {
          "type": "range",
          "id": "margin_bottom",
          "label": "Margin bottom",
          "min": 0,
          "max": 20,
          "step": 1,
          "unit": "px",
          "default": 2
        }
      ]
    },
    {
      "type": "sku",
      "name": "SKU",
      "limit": 1,
      "settings": [
        {
          "type": "checkbox",
          "id": "show_sku",
          "label": "Show SKU",
          "default": true
        },
        {
          "type": "range",
          "id": "margin_top",
          "label": "Margin top",
          "min": 0,
          "max": 20,
          "step": 1,
          "unit": "px",
          "default": 4
        },
        {
          "type": "range",
          "id": "margin_bottom",
          "label": "Margin bottom",
          "min": 0,
          "max": 20,
          "step": 1,
          "unit": "px",
          "default": 4
        }
      ]
    },
    {
      "type": "quantity_selector",
      "name": "Quantity selector",
      "limit": 1,
      "settings": [
        {
          "type": "checkbox",
          "id": "show_quantity_selector",
          "label": "Show quantity selector",
          "default": true
        },
        {
          "type": "range",
          "id": "margin_top",
          "label": "Margin top",
          "min": 0,
          "max": 20,
          "step": 1,
          "unit": "px",
          "default": 14
        },
        {
          "type": "range",
          "id": "margin_bottom",
          "label": "Margin bottom",
          "min": 0,
          "max": 20,
          "step": 1,
          "unit": "px",
          "default": 14
        }
      ]
    },
    {
      "type": "variant",
      "name": "Variant picker",
      "limit": 1,
      "settings": [
        {
          "type": "checkbox",
          "id": "variant",
          "label": "Show variant picker",
          "default": true
        },
        {
          "type": "select",
          "id": "product_selector",
          "label": "Variant selector",
          "options": [
            { "value": "radio", "label": "Pills" },
            { "value": "dropdown", "label": "Dropdown" }
          ],
          "default": "radio"
        },
        {
          "type": "range",
          "id": "margin_top",
          "label": "Margin top",
          "min": 0,
          "max": 20,
          "step": 1,
          "unit": "px",
          "default": 2
        },
        {
          "type": "range",
          "id": "margin_bottom",
          "label": "Margin bottom",
          "min": 0,
          "max": 20,
          "step": 1,
          "unit": "px",
          "default": 2
        }
      ]
    },
    {
      "type": "buy_buttons",
      "name": "Buy buttons",
      "limit": 1,
      "settings": [
        {
          "type": "checkbox",
          "id": "show_buy_buttons",
          "label": "Show buy buttons",
          "default": true
        },
        {
          "type": "text",
          "id": "buy_button_text",
          "label": "Buy button text",
          "default": "Add to cart"
        },
        {
          "type": "range",
          "id": "margin_top",
          "label": "Margin top",
          "min": 0,
          "max": 20,
          "step": 1,
          "unit": "px",
          "default": 2
        },
        {
          "type": "range",
          "id": "margin_bottom",
          "label": "Margin bottom",
          "min": 0,
          "max": 20,
          "step": 1,
          "unit": "px",
          "default": 2
        }
      ]
    },
    {
      "type": "description",
      "name": "Description",
      "limit": 1,
      "settings": [
        {
          "type": "checkbox",
          "id": "show_description",
          "label": "Show description",
          "default": true
        },
        {
          "type": "range",
          "id": "margin_top",
          "label": "Margin top",
          "min": 0,
          "max": 20,
          "step": 1,
          "unit": "px",
          "default": 10
        },
        {
          "type": "range",
          "id": "margin_bottom",
          "label": "Margin bottom",
          "min": 0,
          "max": 20,
          "step": 1,
          "unit": "px",
          "default": 10
        }
      ]
    },
    {
      "type": "accordion_item",
      "name": "Accordion item",
      "limit": 12,
      "settings": [
        {
          "type": "text",
          "id": "trigger",
          "label": "Label"
        },
        {
          "type": "inline_richtext",
          "id": "content",
          "label": "Content"
        }
      ]
    }
  ]
}
{% endschema %}
