{% comment %}
  Renders a video banner section.

  Usage:
  {% sections 'video-banner' %}
{% endcomment %}

{% liquid
  assign color_scheme = section.settings.color_scheme
  assign content_text_alignment = section.settings.content_text_alignment
  assign content_color_scheme = section.settings.content_color_scheme
  assign transparent = section.settings.transparent
  assign url_parts = section.settings.video_url | split: '.'
  assign file_extension = url_parts | last

  assign reduced_padding_top = section.settings.top_padding | times: 0.55 | round: 0
  assign reduced_padding_bottom = section.settings.bottom_padding | times: 0.55 | round: 0
-%}

<style>
  .responsive-padding-{{ section.id }} {
    padding-top: {{ reduced_padding_top }}px;
    padding-bottom: {{ reduced_padding_bottom }}px;
  }

  @media (min-width: 1024px) {
    .responsive-padding-{{ section.id }} {
      padding-top: {{ section.settings.top_padding }}px;
      padding-bottom: {{ section.settings.bottom_padding }}px;
    }
  }
</style>
{% comment %}theme-check-disable RemoteAsset{% endcomment %}
<div class="relative bg-{{ color_scheme }} text-{{ content_text_alignment }} responsive-padding-{{ section.id }}">
  {% if section.settings.video_url != blank %}
    {% comment %}
      <!-- VideoJS youtube implementation for future use -->
      <video
      id="video-{{ section.id }}"
      class="video-js vjs-default-skin aspect-video h-[600px] w-full object-cover"
      preload="auto"
      playsinline
      webkit-playsinline
      data-setup='
      {
      "techOrder": ["youtube"],
      "sources": [{ "type": "video/youtube", "src": "{{ section.settings.video_url }}" }],
      "controls": false,
      "autoplay": true,
      "muted": true,
      {% if section.settings.poster_image %}
      "poster": "{{ section.settings.poster_image }}"
      {% endif %}
      "youtube": {
      "iv_load_policy": 1,
      "rel": 0,
      }
      }
      '
      ></video>
    {% endcomment %}

    <video
      id="video-{{ section.id }}"
      class="aspect-video h-[600px] w-full object-cover"
      {% if section.settings.poster_image %}
        poster="{{ section.settings.poster_image }}"
      {% endif %}
      {% if section.settings.loop_video %}
        loop
      {% endif %}
      playsinline
      webkit-playsinline
      autoplay
      muted
    >
      <source src="{{ section.settings.video_url }}" type="video/{{ file_extension }}">
      Your browser does not support the video tag.
    </video>
    </div>
    {% else %}
    <div class="aspect-video h-[600px] w-full bg-{{ color_scheme }}"></div>
  {% endif %}

  {%- if section.blocks.size >= 1 -%}
    <div class="absolute inset-0 flex h-full w-full {{ section.settings.content_alignment }}">
      <div
        class="
          max-w-[454px] m-8 flex flex-col p-8 {% if transparent %}bg-transparent text-{{ color_scheme }} {% else %}bg-{{ content_color_scheme }} text-{{ content_color_scheme }} {% endif %} text-{{ content_text_alignment }}
          {% case section.settings.content_text_alignment %}
          {% when 'center' %} items-center
          {% when 'right' %} items-end
          {% else %} items-start
          {% endcase %}
        "
      >
        <div class="flex flex-col gap-[8px]">
          {%- for block in section.blocks -%}
            {%- case block.type -%}
              {%- when 'pre_heading' -%}
                <div class="font-display text-headline-x-small font-semibold font-pre-heading">
                  {{ block.settings.pre_heading }}
                </div>
              {%- when 'heading' -%}
                <h2 class="font-display text-display-small font-heading">
                  {{ block.settings.heading }}
                </h2>
              {%- when 'text' -%}
                <div class="font-display text-body-large">{{ block.settings.text }}</div>
            {%- endcase -%}
          {%- endfor -%}
        </div>

        <div class="flex">
          {%- if transparent == false -%}
            {%- assign button_color_scheme = content_color_scheme -%}
          {%- else -%}
            {%- assign button_color_scheme = color_scheme -%}
          {%- endif -%}
          {%- for block in section.blocks -%}
            {%- if block.settings.button_label != blank -%}
              <div class="flex">
                {% render 'button',
                  text: block.settings.button_label,
                  variant: block.settings.button_variant,
                  href: block.settings.button_link,
                  content_color_scheme: button_color_scheme
                %}
              </div>
            {%- endif -%}
          {%- endfor -%}
        </div>
      </div>
    </div>
  {%- endif -%}
</div>

{% schema %}
{
  "name": "Video banner",
  "tag": "section",
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "settings": [
    {
      "type": "url",
      "id": "video_url",
      "label": "Video URL",
      "info": "Youtube, MP4, WebM or OGG"
    },
    {
      "type": "checkbox",
      "id": "loop_video",
      "label": "Loop video",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "transparent",
      "label": "Transparent background",
      "default": false
    },
    {
      "type": "select",
      "id": "content_alignment",
      "label": "Content position",
      "default": "items-center justify-center",
      "options": [
        {
          "value": "items-start justify-start",
          "label": "Top left"
        },
        {
          "value": "items-start justify-center",
          "label": "Top middle"
        },
        {
          "value": "items-start justify-end",
          "label": "Top right"
        },
        {
          "value": "items-center justify-start",
          "label": "Middle left"
        },
        {
          "value": "items-center justify-center",
          "label": "Middle center"
        },
        {
          "value": "items-center justify-end",
          "label": "Middle right"
        },
        {
          "value": "items-end justify-start",
          "label": "Bottom left"
        },
        {
          "value": "items-end justify-center",
          "label": "Bottom middle"
        },
        {
          "value": "items-end justify-end",
          "label": "Bottom right"
        }
      ]
    },
    {
      "type": "select",
      "id": "content_text_alignment",
      "label": "Text alignment",
      "default": "center",
      "options": [
        {
          "value": "left",
          "label": "Left"
        },
        {
          "value": "center",
          "label": "Center"
        },
        {
          "value": "right",
          "label": "Right"
        }
      ]
    },
    {
      "type": "color_scheme",
      "id": "content_color_scheme",
      "label": "Content color scheme",
      "default": "scheme-1"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "scheme-1"
    },
    {
      "type": "range",
      "id": "top_padding",
      "label": "Top padding",
      "min": 0,
      "max": 96,
      "step": 1,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "bottom_padding",
      "label": "Bottom padding",
      "min": 0,
      "max": 96,
      "step": 1,
      "unit": "px",
      "default": 0
    }
  ],
  "blocks": [
    {
      "type": "pre_heading",
      "name": "Pre-heading",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "pre_heading",
          "label": "Pre-heading"
        }
      ]
    },
    {
      "type": "heading",
      "name": "Heading",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "heading",
          "label": "Heading",
          "default": "Heading"
        }
      ]
    },
    {
      "type": "text",
      "name": "Text",
      "limit": 1,
      "settings": [
        {
          "type": "inline_richtext",
          "id": "text",
          "label": "Text",
          "default": "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer luctus sapien ut ipsum volutpat, eget suscipit lectus pretium. Nunc sit amet arcu at felis ornare sollicitudin."
        }
      ]
    },
    {
      "type": "button",
      "name": "Button",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "button_label",
          "label": "Button label",
          "info": "Leave the label blank to hide the button.",
          "default": "Shop the collection"
        },
        {
          "type": "url",
          "id": "button_link",
          "label": "Button link"
        },
        {
          "type": "select",
          "id": "button_variant",
          "label": "Button style",
          "options": [
            {
              "value": "solid",
              "label": "Solid"
            },
            {
              "value": "outline",
              "label": "Outline"
            }
          ],
          "default": "outline"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Video banner",
      "settings": {
        "video_url": "https://videos.pexels.com/video-files/1154850/1154850-hd_1920_1080_24fps.mp4"
      },
      "blocks": [
        {
          "type": "pre_heading",
          "settings": {
            "pre_heading": "Take a look"
          }
        },
        {
          "type": "heading",
          "settings": {
            "heading": "Discover in motion"
          }
        },
        {
          "type": "text",
          "settings": {
            "text": "Use this section to share key details, highlight what's special, or invite action. The video enhances your message, craft it here to connect."
          }
        }
      ]
    }
  ]
}
{% endschema %}
